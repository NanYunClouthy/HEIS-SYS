## 问题分析

1. **现有系统状况**：
   - 已实现患者管理、挂号功能和医生候诊列表
   - 缺少用户认证和权限控制
   - 缺少医生、管理员等角色的表结构
   - 缺少就诊记录编写功能

2. **功能需求**：
   - 实现不同角色（医生、患者、管理员）的登录功能
   - 添加就诊页面，支持医生编写就诊记录
   - 实现权限控制，不同角色看到不同功能

## 解决方案

### 1. 数据库设计

需要添加以下表结构：
- `user`：用户表，存储登录信息
- `role`：角色表，定义角色类型
- `user_role`：用户角色关联表
- `doctor`：医生表，存储医生信息
- `admin`：管理员表，存储管理员信息

### 2. 后端实现

- 实现Spring Security认证和授权
- 创建用户、角色相关的实体类、仓库和服务
- 扩展OPDVisitHistory功能，支持医生编写就诊记录
- 实现角色权限控制

### 3. 前端实现

- 实现登录页面
- 实现就诊记录编写页面
- 实现基于角色的菜单和功能控制
- 优化现有界面，根据角色显示不同功能

## 实施步骤

### 1. 数据库修改

- 在`database copy.txt`中添加用户、角色、医生和管理员表的创建语句

### 2. 后端开发

- 创建用户、角色、医生、管理员实体类
- 实现Spring Security配置
- 开发登录API
- 扩展就诊记录功能

### 3. 前端开发

- 实现登录页面
- 实现就诊记录编写页面
- 实现基于角色的菜单控制
- 优化现有界面，实现权限控制

## 预期效果

- 不同角色（医生、患者、管理员）可以通过登录界面登录系统
- 患者只能看到自己的个人信息、病例、过往就诊记录和挂号功能
- 医生能看到患者的就诊记录、待就诊列表，以及完成就诊功能（叫号、编写就诊记录、过号）
- 管理员可以修改所有人的个人信息、查看就诊记录、查看目前挂号系统状态

## 技术要点

- 使用Spring Security实现认证和授权
- 使用JWT或Session管理用户登录状态
- 使用Vue Router实现前端路由权限控制
- 使用Vuex或Pinia管理全局状态

## 数据库修改计划

在`database copy.txt`中添加以下表结构：

1. `role`表：定义角色类型
2. `user`表：存储用户登录信息
3. `user_role`表：用户角色关联
4. `doctor`表：医生信息
5. `admin`表：管理员信息

现在开始实施这个计划，首先修改数据库结构。