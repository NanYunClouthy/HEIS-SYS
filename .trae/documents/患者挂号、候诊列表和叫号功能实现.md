## 问题分析

1. **现有功能状况**：

   * 已实现患者管理的基本CRUD功能

   * 数据库中已存在OPD（门诊挂号）表结构

   * 缺少OPD相关的实体类、服务和控制器

   * 缺少前端挂号、候诊列表和叫号功能

2. **功能需求**：

   * 患者挂号：创建新患者并生成挂号记录，初始状态为"待就诊"（OPD\_STATS=1）

   * 医生候诊列表：查看状态为"待就诊"的患者列表

   * 叫号功能：点击"叫号"后，患者状态变为"就诊中"（OPD\_STATS=2）

   * 搜索功能：通过病历号或姓名搜索已有患者

   * 过号功能：点击“过号”后，患者状态变为“已过号”（OPD\_STATS=3）

## 解决方案

1. **后端实现**：

   * 创建OPD实体类

   * 创建OPD仓库接口

   * 创建OPD服务接口和实现

   * 创建OPD控制器，实现挂号、获取候诊列表、叫号等API

   * 扩展PatientService，添加患者搜索功能

2. **前端实现**：

   * 扩展patientApi，添加搜索患者功能

   * 创建opdApi，添加挂号、获取候诊列表、叫号等功能

   * 实现挂号页面，支持新患者创建和挂号

   * 实现医生候诊列表页面，展示待就诊患者

   * 实现叫号功能，支持状态更新

## 实施步骤

### 1. 后端开发

#### 1.1 创建OPD实体类

* 在`com.hospital.entity`包下创建`OPD`类

* 映射数据库中的`opd`表

#### 1.2 创建OPD仓库接口

* 在`com.hospital.repository`包下创建`OPDRepository`接口

* 继承JpaRepository，添加自定义查询方法

#### 1.3 创建OPD服务

* 在`com.hospital.service`包下创建`OPDService`接口

* 在`com.hospital.service.impl`包下创建`OPDServiceImpl`实现类

* 实现挂号、获取候诊列表、叫号等功能

#### 1.4 创建OPD控制器

* 在`com.hospital.controller`包下创建`OPDController`类

* 实现挂号、获取候诊列表、叫号等API端点

#### 1.5 扩展PatientService

* 在`PatientService`中添加`searchPatients`方法

* 在`PatientServiceImpl`中实现该方法

* 在`PatientController`中添加搜索API端点

### 2. 前端开发

#### 2.1 扩展API调用

* 在`frontend/src/api/patient.js`中添加搜索患者方法

* 创建`frontend/src/api/opd.js`，添加OPD相关API调用

#### 2.2 实现挂号页面

* 创建`Register.vue`组件

* 支持新患者创建和挂号

* 支持通过病历号或姓名搜索已有患者

#### 2.3 实现医生候诊列表页面

* 创建`WaitingList.vue`组件

* 展示状态为"待就诊"的患者列表

* 实现叫号功能

* 支持实时更新候诊列表

#### 2.4 更新路由配置

* 在`frontend/src/router/index.js`中添加挂号和候诊列表路由

## 预期效果

* 患者可以通过挂号页面创建新患者并完成挂号

* 医生可以通过候诊列表查看待就诊患者

* 医生点击"叫号"后，患者状态变为"就诊中"

* 候诊列表实时更新，已叫号患者状态改变或从列表中移除

* 支持通过病历号或姓名搜索已有患者

## 技术要点

* 使用Spring Boot JPA实现数据访问

* 使用Vue 3实现前端组件

* 使用Axios实现前后端通信

* 数据库中OPD\_STATS字段：1-挂号成功（待就诊），2-叫号（就诊中），3-过号

## 数据库设计

* 无需修改数据库结构，使用现有表结构

* OPD表与PATIENT表通过OPD\_PAT\_ID外键关联

现在开始实施上述计划，实现患者挂号、医生候诊列表和叫号功能。
