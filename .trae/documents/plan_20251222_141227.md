## 任务分析与实施计划

### 1. 任务优先级与依赖关系

| 任务 | 优先级 | 依赖关系 |
|------|--------|----------|
| 1. 修复用户首页跳转逻辑 | 高 | 无 |
| 2. 创建注册界面并实现自动生成病历号功能 | 高 | 无 |
| 3. 修复患者个人中心信息显示 | 中 | 任务2 |
| 4. 重写患者挂号页面 | 高 | 任务2 |
| 5. 修复挂号功能 | 高 | 任务4 |
| 6. 重写患者就诊记录界面 | 中 | 任务2 |
| 7. 优化医生就诊记录界面 | 中 | 任务6 |

### 2. 详细实施计划

#### 2.1 修复用户首页跳转逻辑
- **文件**: `src/views/Login.vue`
- **内容**: 修改登录后的跳转逻辑，根据用户角色跳转到对应的首页
- **具体实现**:
  - 患者：跳转到个人中心
  - 医生：跳转到候诊列表
  - 管理员：跳转到患者列表

#### 2.2 创建注册界面
- **文件**: `src/views/Register.vue`
- **内容**: 实现新用户注册功能，自动生成病历号
- **具体实现**:
  - 表单验证
  - 自动生成病历号（从3开始）
  - 绑定病历号与用户账户
  - 调用后端API完成注册

#### 2.3 修复患者个人中心
- **文件**: `src/views/MyCenter.vue`
- **内容**: 修复个人信息显示问题
- **具体实现**:
  - 从localStorage或API获取完整用户信息
  - 修复信息显示格式
  - 补充完整的个人信息字段

#### 2.4 重写患者挂号页面
- **文件**: `src/views/Register.vue`
- **内容**: 重写挂号功能，直接使用当前患者信息
- **具体实现**:
  - 移除病历号选择
  - 自动填充患者信息
  - 简化挂号流程
  - 调用后端API完成挂号

#### 2.5 修复挂号功能
- **文件**: `src/api/opd.js`
- **内容**: 检查并修复挂号API调用
- **具体实现**:
  - 确保API路径正确
  - 确保请求参数格式正确
  - 添加错误处理

#### 2.6 重写就诊记录界面
- **文件**: `src/views/VisitHistory.vue`
- **内容**: 实现列表展示+详情查看的就诊记录界面
- **具体实现**:
  - 列表展示所有就诊记录
  - 点击行查看详情
  - 根据患者/医生角色显示不同内容
  - 添加分页功能

### 3. 技术实现细节

#### 3.1 自动生成病历号
- 从后端获取当前最大病历号
- 前端生成新的病历号（当前最大+1）
- 确保唯一性

#### 3.2 角色权限控制
- 使用Vue Router的meta字段
- 在路由守卫中检查用户角色
- 根据角色动态生成导航菜单

#### 3.3 API调用优化
- 统一API调用格式
- 添加请求拦截器和响应拦截器
- 实现全局错误处理

#### 3.4 组件复用
- 提取公共组件（如列表、详情面板）
- 使用Vue组件通信
- 实现响应式设计

### 4. 预期效果

- 不同角色登录后跳转到对应首页
- 患者注册时自动生成病历号
- 个人中心显示完整正确的信息
- 挂号流程简化，无需手动选择病历号
- 就诊记录以列表+详情形式展示
- 系统功能正常，无明显bug

### 5. 测试计划

- 单元测试：组件功能测试
- 集成测试：API调用测试
- 端到端测试：完整流程测试
- 角色测试：不同角色功能测试

### 6. 实施步骤

1. 修复登录跳转逻辑
2. 创建注册界面
3. 修复个人中心
4. 重写挂号页面
5. 修复挂号功能
6. 重写就诊记录界面
7. 测试所有功能
8. 优化用户体验
9. 完成最终验收